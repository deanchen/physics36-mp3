<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>MP3: History, Theory, Encoding, and Psychoacoustic</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>
        $(function() {
            $("img.hover").hover(
                function() {
                    var el = $(this);
                    el.attr("data-src", this.src);
                    this.src = "images/" + this.src.split('-')[2];
                },
                function() {
                    this.src = $(this).attr("data-src");
                }
            )
        })
    </script>

</head>
<body>
<div class="wrapper">
    <section>
        <h1>MP3: History, Theory, Encoding, and Psychoacoustics</h1>
        Spectral and frequency analysis of lossless
        <h2>Overview</h2>
            <h3>History</h3>
            <h3>Use</h3>
        <h2>Theory</h2>
            <h3>Bitrate</h3>
            <h3>Sampling Rate</h3>
            <h3>Masking</h3>
            <h3>Mini</h3>
        <h2>LAME</h2>
        <h2>Visual Analysis</h2>
        <h3>Spectral Analysis</h3>
        <p>The spectral graph is a three-dimensional graph that plots the amplitude of each frequency over time.
            It is one of the riches ways to visualize sound.
            Spectral analysis reveals how much, when and where (on the frequency spectrum) sound data is being removed.
            The theory behind the psychoacoustic model should be apparent in the frequency graph.
        </p>

        <p><img class="hover" src="images/wav-sa.gif" alt="wav-sa"></p>

        <h3>Frequency Analysis</h3>
        <p>The sound spectra plots the loudness of sound across the audible frequency range over a short amount of time, in this case two seconds.
            Frequency analysis provides an insight to the MP3 encoding algorithm by showing how the psychoacoustic
            model is used to gradualy remove frequency ranges that is beyond or close to the boundaries of human hearing.
        </p>
        <p><img class="hover" src="images/wav-fa.gif" alt="wav-fa"></p>

        <h3>Comparison of Bitrate on Frequency Profile</h3>
        <p>The following graphs from <a href="http://www.adobe.com/products/audition.html">Adobe Audition</a> show how various encoding settings effect sound quality. 
        The sound sample is taken over a two second period.
        Hover over any of the MP3 spectral or frequency graph to compare it to the lossless graph. 
        Six different encodings with the <a href="http://lame.sourceforge.net/">LAME MP3 encoder</a> are shown, half variable rate and half constant rate in diminishing quality. The graph for the original lossless WAV is included as a reference point.
            <ul>
                <li><a href="#graph-lossless">Lossless WAV</a></li>
                <li><a href="#graph-var-128to256">128-256kbps variable bit rate MP3</a></li>
                <li><a href="#graph-var-64to256">64-256kbps variable bit rate MP3</a></li>
                <li><a href="#graph-var-128to192">128-192kbps variable bit rate MP3</a></li>
                <li><a href="#graph-con-256">256kbps constant bit rate MP3</a></li>
                <li><a href="#graph-con-192">192kbps constant bit rate MP3</a></li>
                <li><a href="#graph-con-128">128kbps constant bit rate MP3</a></li>
            </ul>
            </p>
        <h4 id="graph-lossless">Lossless WAV</h4>
        <p>
        The lossless WAV perfectly caputures sound at the time of the recording as expected; no information is lost.
        The spectral graph is dense and smooth with datapoints across all combinations of time and frequency.
        The frequency graph shows that the sound data covers the entire audible frequency. 
        There is smooth progression loudness across the frequency spectrum with no significant peaks or vallys.
        <p>
        <img class="hover" src="images/wav-sa.gif" alt="wav-sa">
        <img class="hover" src="images/wav-fa.gif" alt="wav-fa">
        </p>
        <h3 id="graph-var-128to256">128-256kbps variable bit rate MP3</h3>
        <p>
        The 128-256kbps vbr encoding preserves much of the nuance of sound in the audiable frequency range.
        The jump in frequency coverage around the middle of the track shows the variable bit rate algorithm in full effect.
        The first half of the sample is noticably less complex than the second part so the vbr algorithmic decision to encode
            the second half of the sample at a higher bitrate than the first makes sense.
        There is a clear frequency cut off at 16kHz and 20kHz. 
        The frequency graph reflects this with a significant valley at the 16kHz and 20kHz mark, otherwise the sound spectra appears to be mostly preserved.
        The reason for the valley and not a hard drop off is that the variable bit rate algorithm increases frequency coverage to 20kHz for the second half of the sample.
        The 20kHz is widely accepted as the boundry of human hearing, while most people cannot hear above 16kHz as they get older. 
        Hovering over the spectral graph reveals that pretty much all the details are preserved under the 16kHz and 20kHz mark.
        The 128-256kbps enconding should failth fully render the original recording to the majority of the population.
        </p>
        <p>
        <img class="hover" src="images/128to256vbr-sa.gif" alt="128to256vbr-sa">
        <img class="hover" src="images/128to256vbr-fa.gif" alt="128to256vbr-fa">
        </p>
        <h3 id="graph-var-64to256">64-256kbps variable bit rate MP3</h3>
        <p>
        The 64-256kbps vbr encoding graphs do not look much different from the 128-256kbps vbr encoding.
        The frequency coverage below the 16kHz and 20kHz mark appears to be just as rich, the only difference 
        seems to be the lack of of spotty frequency coverage above teh 16kHz mark in the first part of the sample.
        The is the result of the lower boundary of 64kbps compared to the lower boundary of 128kbps of the previous encoding.
        A likely explanation is that the LAME vbr encoder did not consider the frequency range above 16kHz in the first part of the 
        sample to be worth storing. 
        The only reason it did so was to satisfy the 128kbps minimum bit rate.
        As expected, the frequency graph reamins esentially unchaged compared to 128-256kpbs vbr encoding.
        The file size likely came out a bit smaller without the loss of authenticity in sound reproduction compared to 128-256kbps vbr and the lossless source.
        </p>
        <p>
        <img class="hover" src="images/64to256vbr-sa.gif" alt="64to256vbr-sa">
        <img class="hover" src="images/64to256vbr-fa.gif" alt="64to256vbr-fa">
        </p>
        <h3 id="graph-var-128to192">128-192kbps variable bit rate MP3</h3>
        <p>
        Lowering the upper boundary from 256kbps to 192kbps does produce noticible change in the spectral graph.
        The frequency cutoff in the second part of the now creeps under the 20kHz in to the 16kHz mark. 
        However, this should not impact the audio quality since 16kHz is beyond the hearing range of most anyways.
        The spotty coverage of ferquency above 16kHz in the first part of sample returns, confirming that it is just an 
        artifact of the 128kbps minimum encoding rate.
        There is a slight reduction in sound density in the audioble range, most noticibly at the one large and two small holes
        that begin to appear in the first part of the sample.
        However, this is likely to be the pyschoacoustic model being used to reduce close to inaudible data. 
        The largest hole is only about 70ms wide expected to have very little effect on sound quality because of the duration.
        The removed sound data is also likely to be masked by the high amplitude frequences just below the 10kHz mark.
        The frequency graph remains unchanged from the other vbr encodings.
        <p>
        <img class="hover" src="images/128to192vbr-sa.gif" alt="128to192vbr-sa">
        <img class="hover" src="images/128to192vbr-fa.gif" alt="128to192vbr-fa">
        </p>
        <h3 id="graph-con-256">256kbps constant bit rate MP3</h3>
        <p>
           There is no suprise that the spectral graph looks almost as complete as that of the original lossless WAV given 
           the positive results from the vbr encodings.
           The difference in encoding approach between the cbr and vbr is obvious given that the frequency coverage and bitrate stays constant in this case. 
           There was a noticible jump in frequency coverage in the vbr spectral graph. 
           Almost all details are faithfully preserved under the 21kHz mark.
           The fact that the LAME encoder chose to preserve frequencies above the audible limit of 20kHz is indicative that 256kbps 
           is more than enough to capture the full range of sounds from the original lossless source. 
           The spectra closely matches that of the original WAV supporting the fact that sound quality is almost perfectly preserved. 
        </p>
        <p>
        <img class="hover" src="images/256cbr-sa.gif" alt="256cbr-sa">
        <img class="hover" src="images/256cbr-fa.gif" alt="256cbr-fa">
        </p>
        <h3 id="graph-con-192">192kbps constant bit rate MP3</h3>
        <p>The spectral graph for 192kbps cbr looks good as expected. 
        Compared to the 256kbps cbr, the frequency converage was reduced to about 19kHz across all of the two seconds. 
        This is unlikely to cause a significant degradtion in sound quality given that 19kHz is still well above the safe standard of 16kHz for the vast majority of the population. 
        The spectral graph otherwise shows that a 192kbps cbr enconding preserves much of the details in the audible range of the original sample.</p>
        <p>
        The spectra of the encoded sample reveals something interesting. There is a significant valley at the 16kHz mark. This valley was not present in the 256kbps cbr encoding but was present in all the vbr encoded samples. The valley made sense for vbr samples because half of the sample was encoded at a higher bit rate than the other. 
        However, the entire sample is encoded at the same bit rate in this case, which makes the valley very odd.
        The limitation of constant bit rate would seemlingly prevent the optimization of encoding less complex frames at a lower bitrate to free up bits for more complex frames.
        </p>
        <p>
        The 16kHz valley is not so mysterious when we consider the role of the bit reservoir.
        The bit reservoir comes in to effect only when the bitrate is reduced from 256kbps to 192kbps cbr beacause certain complex frames, especially in the second half of the sample, likely came under strain by bitrate reduction.
        The bit reservoir allows these complex frames to store its extra data in the previous frame at the cost of reducing the bitrate of the previous frame. 
        The valley at 16kHz is attributed to the lower bitrate frames that is storing the data of its more complex neighbors.  
        <p>
        <img class="hover" src="images/192cbr-sa.gif" alt="192cbr-sa">
        <img class="hover" src="images/192cbr-fa.gif" alt="192cbr-fa">
        </p>
        <h3 id="graph-con-128">128kbps constant bit rate MP3</h3>
        <p>
        Finallly the bitrate is low enough to force the LAME encoder to make compromises.
        The immediate observation is that frequency coverage has been reduced to below 16kHz, the optimistic upper boundary for human perception.  
        This will likely cause a subtle degration in sound quality.
        We also see that the frequencies under the coverage range is less rich. Lines are more finely defined and the holes are numerous and more apparent.
        </p>
        <p>
        The effects of eliminating data according to the psychoacoustic model is more obvious. The dotted streak of holes in the second part of the sample right above the 8kHz mark is likly to be masked by the two much stronger streaks of frequencies(8kHz, 9.5kHz). 
        Although the details of low and midrange(up to 5kHz) seems mostly preserved, the frequency coverage above looks noticibly more sparse and hollow compared to the original sample.
        This observation is also reflected in the sound spectra. The spectra looks noticibly different compared to the original with deep vallies below the 500Hz, at the 7.5kHz and 1000kHz mark where only a small dent used to exist.
        </p>
        <p>
        <img class="hover" src="images/128cbr-sa.gif" alt="128cbr-sa">
        <img class="hover" src="images/128cbr-fa.gif" alt="128cbr-fa">
        </p>
        <h3>Conclusion</h3>
        <p>The spectral and frequency analysis reveals that 192kbps is likely the lowest acceptable bitrate. Encoding at 128kbps is a minimum if authenticity of reproduction is a concern. 
        However, the efficiency of the LAME encoder is impressive given that it can achieve a 6:1 compression ratio compared to the 1411kbps audio-CD source without almost no sacrifice to sound quality. 
        The variable bit rate encoding will enable an even higher compression ratio while preserving sound quality. 
        </p>
    <h2>Real World Studies</h2>

    </section>
    <section>
        <h2>References</h2>
            <h3>General</h3>
            <p>
                <a href="http://inventors.about.com/od/mstartinventions/a/MPThree.htm">The History of MP3</a> (Bellis)<br />
                <a href="http://www.mp3-history.com/en/the_story_of_mp3.html">The mp3 History</a><br />
                <a href="http://wiki.hydrogenaudio.org/index.php?title=MP3">MP3</a><br />
            </p>
            <h3>Theory</h3>
            <p>
                <a href="http://www.mp3-tech.org/tech.html">Overview of MP3 techniques</a> (Bouvigne, 2001) <br />
                <a href="http://oreilly.com/catalog/mp3/chapter/ch02.html">MP3: The Definitive Guide - Chapter 2</a> (Hacker, 2000)<br />
                <a href="http://www.codinghorror.com/blog/2005/12/variable-bit-rate-getting-the-best-bang-for-your-byte.html">Variable Bit Rate: Getting the best Bang for your Byte</a> (Atwood, 2005)<br />
                <a href="http://thestereobus.com/2008/01/12/sample-rate-and-bitrate-the-guts-of-digital-audio/">Sample Rate and Bitrate: The Guts of Digital Audio</a> (Connor, 2008)<br />
                <a href="http://www.cpl.umn.edu/auditory.htm">Psychoacoustics Publications</a>
            </p>
            <h3>Encoding</h3>
            <p>
                <a href="http://arstechnica.com/old/content/2007/10/the-audiofile-understanding-mp3-compression.ars/1">The AudioFile: Understanding MP3 compression</a> (Wilburn, 2008)<br />
                <a href="http://blog.bjrn.se/2008/10/lets-build-mp3-decoder.html">Let's build an MP3-decoder</a> (Edstrom, 2008)<br />
                <a href="http://www.soundonsound.com/sos/may00/articles/mp3.htm">Perceptual Coding: How Mp3 Compression Works</a> (Sellars, 2000)<br />
                <a href="http://sourceforge.net/projects/lame/#">LAME Source Code</a><br />
                <a href="http://sourceforge.net/projects/lame/#">LAME Website</a><br />
                <a href="http://lame.sourceforge.net/gpsycho.php">GPSYCHO - A LGPL'd Psycho-Acoustic Model</a><br />
                <a href="http://cutebugs.net/files/mpeg-drafts/11172-3.pdf">MP3 ISO Coding Standard</a> (1991)<br />
            </p>
            <h3>Spectral/Frequency Analysis</h3>
            <p>
                <a href="http://help.adobe.com/en_US/Audition/3.0/help.html?content=WS58a04a822e3e5010548241038980c2c5-7f85.html">About Spectral Frequency Display</a><br />
                <a href="http://tv.adobe.com/watch/audition-feature-tour/spectral-editing-techniques-in-adobe-audition-for-the-mac/">Spectral Editing Techniques in Adobe Audition for the Mac</a> (Levin, 2010)<br />
                <a href="http://blowfish.be/eac/Spectral/spectral.html">http://blowfish.be/eac/Spectral/spectral.html</a> (2002)<br />
                <a href="http://www.audiohub.org/get/fa/fa.htm">Detecting MP3-Sourced and Mini-Disc Audio</a> (2002)<br />
            </p>
            <h3>Studies</h3>
            <p>
                <a href="http://listening-tests.freetzi.com/html/128kbps_Extension_public_listening_test_results.htm">Results of 128kbps Extension Public Listening Test</a> (Amorim)<br />
            </p>

    </section>
    <footer>
        <p>Dean Chen - May 4th, 2012</p>
    </footer>
</div>
<script src="javascripts/scale.fix.js"></script>
</body>
</html>
